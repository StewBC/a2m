// 6502 assembler
// Stefan Wessels, 2025
// This is free and unencumbered software released into the public domain.

#include "asm_lib.h"

//     A  |  A  |  A  |  A  |  I  |  I  |  I  |  I  |  Z  |  Z  |  Z
//     C  |  B  |  B  |  B  |  M  |  N  |  N  |  N  |  E  |  E  |  E
//     C  |  S  |  S  |  S  |  M  |  D  |  D  |  D  |  R  |  R  |  R
//     U  |  O  |  O  |  O  |  E  |  I  |  I  |  I  |  O  |  O  |  O
//     M  |  L  |  L  |  L  |  D  |  R  |  R  |  R  |  P  |  P  |  P
//     U  |  U  |  U  |  U  |  I  |  E  |  E  |  E  |  A  |  A  |  A
//     L  |  T  |  T  |  T  |  A  |  C  |  C  |  C  |  G  |  G  |  G
//     A  |  E  |  E  |  E  |  T  |  T  |  T  |  T  |  E  |  E  |  E
//     T  |     |  ,  |  ,  |  E  |  ,  |  ,  |     |  /  |  ,  |  ,
//     O  |     |  X  |  Y  |     |  X  |  Y  |     |  R  |  X  |  Y
//     R  |     |     |     |     |     |     |     |  E  |     |  
//     /  |     |     |     |     |     |     |     |  L  |     |  
//     I  |     |     |     |     |     |     |     |  A  |     |  
//     M  |     |     |     |     |     |     |     |  T  |     |  
//     P  |     |     |     |     |     |     |     |  I  |     |  
//     L  |     |     |     |     |     |     |     |  V  |     |  
//     I  |     |     |     |     |     |     |     |  E  |     |  
//     E  |     |     |     |     |     |     |     |     |     |  
//     D  |     |     |     |     |     |     |     |     |     |  
const uint8_t asm_opcode[GPERF_OPCODE_TYA+1][ADDRESS_MODE_ZEROPAGE_Y+1] = {
    { -1  , 0x6d, 0x7d, 0x79, 0x69, 0x61, 0x71, 0x72, 0x65, 0x75, -1   }, /*  0: ADC */
    { -1  , 0x2d, 0x3d, 0x39, 0x29, 0x21, 0x31, 0x32, 0x25, 0x35, -1   }, /*  1: AND */
    { 0x0a, 0x0e, 0x1e, -1  , -1  , -1  , -1  , -1  , 0x06, 0x16, -1   }, /*  2: ASL */
    { -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , 0x90, -1  , -1   }, /*  3: BCC */
    { -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , 0xb0, -1  , -1   }, /*  4: BCS */
    { -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , 0xf0, -1  , -1   }, /*  5: BEQ */
    { -1  , 0x2c, 0x3c, -1  , 0x89, -1  , -1  , -1  , 0x24, 0x34, -1   }, /*  6: BIT */
    { -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , 0x30, -1  , -1   }, /*  7: BMI */
    { -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , 0xd0, -1  , -1   }, /*  8: BNE */
    { -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , 0x10, -1  , -1   }, /*  9: BPL */
    { -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , 0x80, -1  , -1   }, /* 10: BRA */
    { 0x00, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 11: BRK */
    { -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , 0x50, -1  , -1   }, /* 12: BVC */
    { -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , 0x70, -1  , -1   }, /* 13: BVS */
    { 0x18, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 14: CLC */
    { 0xd8, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 15: CLD */
    { 0x58, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 16: CLI */
    { 0xb8, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 17: CLV */
    { -1  , 0xcd, 0xdd, 0xd9, 0xc9, 0xc1, 0xd1, 0xd2, 0xc5, 0xd5, -1   }, /* 18: CMP */
    { -1  , 0xec, -1  , -1  , 0xe0, -1  , -1  , -1  , 0xe4, -1  , -1   }, /* 19: CPX */
    { -1  , 0xcc, -1  , -1  , 0xc0, -1  , -1  , -1  , 0xc4, -1  , -1   }, /* 20: CPY */
    { 0x3a, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 21: DEA */
    { -1  , 0xce, 0xde, -1  , -1  , -1  , -1  , -1  , 0xc6, 0xd6, -1   }, /* 22: DEC */
    { 0xca, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 23: DEX */
    { 0x88, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 24: DEY */
    { -1  , 0x4d, 0x5d, 0x59, 0x49, 0x41, 0x51, 0x52, 0x45, 0x55, -1   }, /* 25: EOR */
    { 0x1a, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 26: INA */
    { -1  , 0xee, 0xfe, -1  , -1  , -1  , -1  , -1  , 0xe6, 0xf6, -1   }, /* 27: INC */
    { 0xe8, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 28: INX */
    { 0xc8, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 29: INY */
    { -1  , 0x4c, -1  , -1  , -1  , 0x7c, -1  , 0x6c, -1  , -1  , -1   }, /* 30: JMP */
    { -1  , 0x20, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 31: JSR */
    { -1  , 0xad, 0xbd, 0xb9, 0xa9, 0xa1, 0xb1, 0xb2, 0xa5, 0xb5, -1   }, /* 32: LDA */
    { -1  , 0xae, -1  , 0xbe, 0xa2, -1  , -1  , -1  , 0xa6, -1  , 0xb6 }, /* 33: LDX */
    { -1  , 0xac, 0xbc, -1  , 0xa0, -1  , -1  , -1  , 0xa4, 0xb4, -1   }, /* 34: LDY */
    { 0x4a, 0x4e, 0x5e, -1  , -1  , -1  , -1  , -1  , 0x46, 0x56, -1   }, /* 35: LSR */
    { 0xea, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 36: NOP */
    { -1  , 0x0d, 0x1d, 0x19, 0x09, 0x01, 0x11, 0x12, 0x05, 0x15, -1   }, /* 37: ORA */
    { 0x48, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 38: PHA */
    { 0x08, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 39: PHP */
    { 0xda, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 40: PHX */
    { 0x5a, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 41: PHY */
    { 0x68, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 42: PLA */
    { 0x28, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 43: PLP */
    { 0xfa, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 44: PLX */
    { 0x7a, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 45: PLY */
    { 0x2a, 0x2e, 0x3e, -1  , -1  , -1  , -1  , -1  , 0x26, 0x36, -1   }, /* 46: ROL */
    { 0x6a, 0x6e, 0x7e, -1  , -1  , -1  , -1  , -1  , 0x66, 0x76, -1   }, /* 47: ROR */
    { 0x40, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 48: RTI */
    { 0x60, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 49: RTS */
    { -1  , 0xed, 0xfd, 0xf9, 0xe9, 0xe1, 0xf1, 0xf2, 0xe5, 0xf5, -1   }, /* 50: SBC */
    { 0x38, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 51: SEC */
    { 0xf8, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 52: SED */
    { 0x78, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 53: SEI */
    { -1  , 0x8d, 0x9d, 0x99, -1  , 0x81, 0x91, 0x92, 0x85, 0x95, -1   }, /* 54: STA */
    { -1  , 0x8e, -1  , -1  , -1  , -1  , -1  , -1  , 0x86, -1  , 0x96 }, /* 55: STX */
    { -1  , 0x8c, -1  , -1  , -1  , -1  , -1  , -1  , 0x84, 0x94, -1   }, /* 56: STY */
    { -1  , 0x9c, 0x9e, -1  , -1  , -1  , -1  , -1  , 0x64, 0x74, -1   }, /* 57: STZ */
    { 0xaa, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 58: TAX */
    { 0xa8, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 59: TAY */
    { -1  , 0x1c, -1  , -1  , -1  , -1  , -1  , -1  , 0x14, -1  , -1   }, /* 60: TRB */
    { -1  , 0x0c, -1  , -1  , -1  , -1  , -1  , -1  , 0x04, -1  , -1   }, /* 61: TSB */
    { 0xba, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 62: TSX */
    { 0x8a, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 63: TXA */
    { 0x9a, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 64: TXS */
    { 0x98, -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1  , -1   }, /* 65: TYA */
};

// In this table the values are:
// -1 - Not a valid opcode
//  0 - A valid 65c02 opcode only
//  1 - A valid 6502 opcode
const uint8_t asm_opcode_type[GPERF_OPCODE_TYA+1][ADDRESS_MODE_ZEROPAGE_Y+1] = {
    {-1   , 1   , 1   , 1   , 1   , 1   , 1   ,  0  , 1   , 1   ,-1}    , /*  0: ADC */
    {-1   , 1   , 1   , 1   , 1   , 1   , 1   ,  0  , 1   , 1   ,-1}    , /*  1: AND */
    { 1   , 1   , 1   ,-1   ,-1   ,-1   ,-1   , -1  , 1   , 1   ,-1}    , /*  2: ASL */
    {-1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  , 1   ,-1   ,-1}    , /*  3: BCC */
    {-1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  , 1   ,-1   ,-1}    , /*  4: BCS */
    {-1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  , 1   ,-1   ,-1}    , /*  5: BEQ */
    {-1   , 1   , 0   ,-1   , 0   ,-1   ,-1   , -1  , 1   , 0   ,-1}    , /*  6: BIT */
    {-1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  , 1   ,-1   ,-1}    , /*  7: BMI */
    {-1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  , 1   ,-1   ,-1}    , /*  8: BNE */
    {-1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  , 1   ,-1   ,-1}    , /*  9: BPL */
    {-1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  , 0   ,-1   ,-1}    , /* 10: BRA */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 10: BRK */
    {-1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  , 1   ,-1   ,-1}    , /* 11: BVC */
    {-1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  , 1   ,-1   ,-1}    , /* 12: BVS */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 13: CLC */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 14: CLD */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 15: CLI */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 16: CLV */
    {-1   , 1   , 1   , 1   , 1   , 1   , 1   ,  0  , 1   , 1   ,-1}    , /* 17: CMP */
    {-1   , 1   ,-1   ,-1   , 1   ,-1   ,-1   , -1  , 1   ,-1   ,-1}    , /* 18: CPX */
    {-1   , 1   ,-1   ,-1   , 1   ,-1   ,-1   , -1  , 1   ,-1   ,-1}    , /* 19: CPY */
    { 0   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 20: DEA */
    {-1   , 1   , 1   ,-1   ,-1   ,-1   ,-1   , -1  , 1   , 1   ,-1}    , /* 20: DEC */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 21: DEX */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 22: DEY */
    {-1   , 1   , 1   , 1   , 1   , 1   , 1   ,  0  , 1   , 1   ,-1}    , /* 23: EOR */
    { 0   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 24: INA */
    {-1   , 1   , 1   ,-1   ,-1   ,-1   ,-1   , -1  , 1   , 1   ,-1}    , /* 24: INC */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 25: INX */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 26: INY */
    {-1   , 1   ,-1   ,-1   ,-1   , 0   , 1   ,  1  ,-1   ,-1   ,-1}    , /* 27: JMP */
    {-1   , 1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 28: JSR */
    {-1   , 1   , 1   , 1   , 1   , 1   , 1   ,  0  , 1   , 1   ,-1}    , /* 29: LDA */
    {-1   , 1   ,-1   , 1   , 1   ,-1   ,-1   , -1  , 1   ,-1   , 1}    , /* 30: LDX */
    {-1   , 1   , 1   ,-1   , 1   ,-1   ,-1   , -1  , 1   , 1   ,-1}    , /* 31: LDY */
    { 1   , 1   , 1   ,-1   ,-1   ,-1   ,-1   , -1  , 1   , 1   ,-1}    , /* 32: LSR */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 33: NOP */
    {-1   , 1   , 1   , 1   , 1   , 1   , 1   ,  0  , 1   , 1   ,-1}    , /* 34: ORA */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 35: PHA */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 36: PHP */
    { 0   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 36: PHX */
    { 0   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 36: PHY */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 37: PLA */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 38: PLP */
    { 0   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 38: PLX */
    { 0   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 38: PLY */
    { 1   , 1   , 1   ,-1   ,-1   ,-1   ,-1   , -1  , 1   , 1   ,-1}    , /* 39: ROL */
    { 1   , 1   , 1   ,-1   ,-1   ,-1   ,-1   , -1  , 1   , 1   ,-1}    , /* 40: ROR */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 41: RTI */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 42: RTS */
    {-1   , 1   , 1   , 1   , 1   , 1   , 1   ,  0  , 1   , 1   ,-1}    , /* 43: SBC */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 44: SEC */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 45: SED */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 46: SEI */
    {-1   , 1   , 1   , 1   ,-1   , 1   , 1   ,  0  , 1   , 1   ,-1}    , /* 47: STA */
    {-1   , 1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  , 1   ,-1   , 1}    , /* 48: STX */
    {-1   , 1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  , 1   , 1   ,-1}    , /* 49: STY */
    {-1   , 0   , 0   ,-1   ,-1   ,-1   ,-1   , -1  , 0   , 0   ,-1}    , /* 49: STZ */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 50: TAX */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 51: TAY */
    {-1   , 0   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  , 0   ,-1   ,-1}    , /* 52: TRB */
    {-1   , 0   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  , 0   ,-1   ,-1}    , /* 52: TSB */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 52: TSX */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 53: TXA */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 54: TXS */
    { 1   ,-1   ,-1   ,-1   ,-1   ,-1   ,-1   , -1  ,-1   ,-1   ,-1}    , /* 55: TYA */
};

const char *address_mode_txt[] = {
    "ACCUMULATOR/IMPLIED",
    "ABSOLUTE",
    "ABSOLUTE,X",
    "ABSOLUTE,Y",
    "IMMEDIATE",
    "(INDIRECT,X)",
    "(INDIRECT),Y",
    "ZEROPAGE/RELATIVE",
    "ZEROPAGE,X",
    "ZEROPAGE,Y",
};
